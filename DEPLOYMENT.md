# 部署手册

本手册将指导您如何将您的 Next.js 应用部署到生产服务器。

## 1. 先决条件

在开始之前，请确保您的服务器已安装以下软件：

*   **Node.js** (建议使用最新的 LTS 版本)
*   **npm** 或 **yarn**
*   **Git**

## 2. 部署步骤

### 2.1. 克隆代码库

首先，通过 SSH 连接到您的服务器，然后使用 Git 克隆您的代码库：

```bash
git clone <您的代码库 URL>
cd <您的项目目录>
```

### 2.2. 安装依赖

进入项目目录后，安装所有项目依赖：

```bash
npm install
# 或者
yarn install
```

### 2.3. 配置环境变量

您的应用可能需要一些环境变量。在项目根目录创建一个 `.env.local` 文件，并添加必要的变量。例如：

```
DATABASE_URL="file:./fishing_app.db"
```

### 2.4. 构建应用

接下来，为生产环境构建您的 Next.js 应用：

```bash
npm run build
# 或者
yarn build
```

此命令将在 `.next` 目录下生成一个优化后的生产版本。

### 2.5. 启动生产服务器

最后，启动生产服务器以运行您的应用：

```bash
npm start
# 或者
yarn start
```

默认情况下，应用将在 `3000` 端口上运行。您可以通过 `-p` 标志指定一个不同的端口：

```bash
npm start -- -p 8080
# 或者
yarn start -p 8080
```

## 3. 使用 PM2 进行进程管理

为了确保您的应用在服务器重启后能够自动恢复，并实现负载均衡，我们强烈建议使用 **PM2**。

### 3.1. 安装 PM2

在您的服务器上全局安装 PM2：

```bash
npm install pm2 -g
```

### 3.2. 使用 PM2 启动应用

使用 PM2 启动您的 Next.js 应用：

```bash
pm2 start npm --name "<您的应用名称>" -- start
```

### 3.3. 配置 PM2 开机自启

为了让 PM2 在服务器重启后自动启动，请运行以下命令：

```bash
pm2 startup
```

它会生成一条需要在终端中执行的命令，复制并运行该命令即可。

### 3.4. 保存 PM2 配置

最后，保存当前的 PM2 进程列表，以便在重启后恢复：

```bash
pm2 save
```

## 4. 总结

现在，您的 Next.js 应用已成功部署并正在生产服务器上运行。您可以通过服务器的 IP 地址和指定的端口访问它。
